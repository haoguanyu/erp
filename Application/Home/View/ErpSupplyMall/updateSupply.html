<include file="./Application/Home/View/headers.html"/>
<link rel="stylesheet" href="__TPL__lib/select2/css/select2.min.css"/>
<style>
    .input-text {
        width: 80%
    }

    #erpgoods {
        width: 100%
    }
    .disabled {
        cursor: no-drop;
        background-color: #9D9D9D;
    }
</style>
<script type="text/javascript" src="__TPL__lib/select2/js/select2.min.js"></script>
<script type="text/javascript" src="__TPL__static/select.js"></script>
<article class="page-container" style=" overflow:hidden;" id="input_list">
    <form action="" method="post" class="form form-horizontal" id="form-member-add">
        <div>
            <div class="row cl col-sm-12">
                <p>基本信息</p>
                <hr/>
                <br/>
                <label class="form-label col-xs-2 "><span class="c-red">*</span>供货单号:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text" id="supply_number" name="supply_number" value="<{$data.supply_number}>"
                           placeholder="系统自动生成" readonly="readonly"/>
                </div>

                <label class="form-label col-xs-2 "><span class="c-red">*</span>交易员:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text" id="dealer_name" name="dealer_name"
                           value="<{$data.dealer_name}>" readonly>
                    <input type="hidden" class="input-text" id="dealer_id" name="dealer_id"
                           value="<{$data.dealer_id}>">
                    <span id="sps3"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>用户:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="user_info" name="user_info" class="input-text" onchange="changebyuser()" disabled>

                        <volist name="select_data.user" id="vo" key="k">
                            <option value="<{$select_data['dealer']['dealer_id']}>">
                                <{$data['company_name']}>
                            </option>
                        </volist>
                    </select>
                    <input type="hidden" class="input-text" id="supply_user_id" name="supply_user_id" value="<{$data['supply_user_id']}>">
                    <span id="sps1"></span>
                </div>

                <label class="form-label col-xs-2 "><span class="c-red">*</span>我方公司:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="supply_company_id" name="supply_company_id" class="input-text" width="10%" disabled> <!-- onchange="changeremittance()" -->
                        <option value="0">请选择</option>
                        <volist name="data.our_company" id="vo">
                            <option value="<{$key}>" <if condition="$data.supply_company_id eq $key">selected</if> ><{$vo}></option>
                        </volist>
                    </select>
                    <span id="sps2"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <p>商品信息</p>
                <hr/>
                <br/>
                <table class="table table-border table-bordered table-hover" id="dataTable" style="width: 87%; float: left; margin-left: 5%;">
                    <thead>
                    <th>商品代码</th>
                    <th>商品名称</th>
                    <th>商品来源</th>
                    <th>商品标号</th>
                    <th>商品级别</th>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <!--<select id="erpgoods" name="erpgoods" class="input-text di" onchange="showGoods()" disabled>-->
                            <!--<option value="">请选择</option>-->
                            <!--<volist name="erpgoods" id="vo" key="k">-->
                            <!--<option value="<{$key}>" <if condition="$data['region_goods']['id'] eq $key">selected</if>>-->
                            <!--<{$vo.goods_code}>-<{$vo.goods_name}>-<{$vo.source_from}>-<{$vo.grade}>-<{$vo.level}>-->
                            <!--</option>-->
                            <!--</volist>-->
                            <!--</select>-->
                            <{$data.goods_code}>
                            <input type="hidden" id="goods_id" value="<{$data.goods_id}>">
                        </td>
                        <td id="goods_name"><{$data.goods_name}></td>
                        <td id="source_from"><{$data.source_from}></td>
                        <td id="grade"><{$data.grade}></td>
                        <td id="level"><{$data.level}></td>
                    </tr>
                    </tbody>
                </table>
                <span id="sps4" style="margin-left: 5px"></span>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>城市:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="region" name="region" class="input-text" width="10%" onchange="changebyregion()" disabled>
                        <option value="">请选择</option>
                        <volist name="region.region_list" id="vo" key="k">
                            <option value="<{$key}>" <if condition="$data['region'] eq $key">selected</if> >
                            <{$vo}>
                            </option>
                        </volist>
                    </select>
                    <span id="sps5"></span>
                </div>
                <label class="form-label col-xs-2 "><span class="c-red">*</span>仓库:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="storehouse_data" name="storehouse_data" class="input-text" width="10%" onchange="checkstorehouse()">
                        <option value="">请选择</option>
                         <volist name="storehouse_data" id="vo" key="k">
                            <option value="<{$vo.id}>" <if condition="$vo.id eq $data['storehouse_id']">selected</if>>
                            <{$vo.storehouse_name}>
                            </option>
                        </volist>
                    </select>
                    <span id="sps6"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>单位价格:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text disabled" id="price" name="price" value="<{$data.region_goods.price}>" onblur="checkprice()"
                           onkeyup="checkinteger(this)" disabled>
                    <span id="sps7"></span>
                </div>
                <label class="form-label col-xs-2 "><span class="c-red">*</span>油库:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="depot_id" name="depot_id" class="input-text" width="10%" onchange="checkdepotid()">
                        <if condition = "!empty($depot)">
                            <option value="">请选择</option>
                            <option value ='99999' <if condition="$data['depot_id'] eq 99999">selected</if>>不限油库</option>
                             <volist name="depot" id="vo" key="k">
                                <option value="<{$vo.id}>" <if condition="$vo.id eq $data['depot_id']">selected</if>>
                                <{$vo.depot_name}>
                                </option>
                            </volist>
                        <else/>
                            <option value="<{$data.depot_id}>"><{$data.depot_name}></option>
                        </if>
                    </select>
                    <span id="sps6"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>起售数量:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text" id="min_sale_num" name="min_sale_num" value="<{$data.min_sale_num}>"
                           onblur="checkminsalenum()" maxlength="10" onkeyup="checknum4(this)">
                    <span id="sps9"></span>
                </div>

                <label class="form-label col-xs-2 "><span class="c-red">*</span>可售数量:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text disabled" id="sale_num" name="sale_num" value="<{$data.stock_available_sale_num}>" onblur="checksalenum()"
                           onkeyup="checknum(this)" disabled>
                    <span id="sps8"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>提货方式:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="pick_up_way" name="pick_up_way" class="input-text" width="10%"
                            onchange="checkpickupway()">
                        <option value="">请选择</option>
                        <volist name="select_data.pick_up_way" id="vo" key="k">
                            <option value="<{$key}>" <if condition="$data.pick_up_way eq $key">selected</if> >
                                <{$vo}>
                            </option>
                        </volist>
                    </select>
                    <span id="sps11"></span>
                </div>

                <label class="form-label col-xs-2 "><span class="c-red">*</span>单笔最大数量:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text" id="max_once_num" name="max_once_num" value="<{$data.max_once_num}>"
                           onblur="checkmaxoncenum()" maxlength="10" onkeyup="checknum4(this)">
                    <span id="sps10"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 "><span class="c-red">*</span>开票类型:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="invoice_type" name="invoice_type" class="input-text" width="10%"
                            onchange="checkinvoicetype()">
                        <option value="">请选择</option>
                        <volist name="select_data.invoice_type" id="vo" key="k">
                            <option value="<{$key}>" <if condition="$data.invoice_type eq $key">selected</if> >
                                <{$vo}>
                            </option>
                        </volist>
                    </select>
                    <span id="sps13"></span>
                </div>

                <label class="form-label col-xs-2 "><span class="c-red">*</span>商品状态:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="goods_status" name="goods_status" class="input-text" width="10%"
                            onchange="checkgoodsstatus()">
                        <option value="">请选择</option>
                        <volist name="select_data.goods_status" id="vo" key="k">
                            <option value="<{$key}>" <if condition="$data.goods_status eq $key">selected</if> >
                                <{$vo}>
                            </option>
                        </volist>
                    </select>
                    <span id="sps12"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 ">已锁数量:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input type="text" class="input-text" id="lock_num" name="lock_num"
                           value="<{$data['lock_num']}>" disabled>
                </div>
            
                <label class="form-label col-xs-2 "><span class="c-red">*</span>是否服务:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="is_service" name="is_service" class="input-text" width="10%"
                            onchange="checkisservice()">
                        <option value="">请选择</option>
                        <option value="1" <if condition="$data.is_service eq 1">selected</if>>是</option>
                        <option value="2" <if condition="$data.is_service eq 2">selected</if>>否</option>
                    </select>
                    <span id="sps14"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <p>服务信息</p>
                <hr/>
                <br/>
                <!--<label class="form-label col-xs-2 "><span class="c-red">*</span>商城商品:</label>-->

                <!--<div class="formControls col-xs-9 col-sm-4">-->
                <!--&lt;!&ndash;<select id="mall_goods" name="mall_goods" class="input-text" width="10%"&ndash;&gt;-->
                <!--&lt;!&ndash;onchange="checkmallgoods('blur')">&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="">请选择</option>&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="1">是</option>&ndash;&gt;-->
                <!--&lt;!&ndash;<option value="2">否</option>&ndash;&gt;-->
                <!--&lt;!&ndash;</select>&ndash;&gt;-->
                <!--<span id="sps15"></span>-->
                <!---->
                <!--</div>-->
                <label class="form-label col-xs-2 "><span class="c-red">*</span>显示在前台:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="show_front" name="show_front" class="input-text" width="10%"
                            onchange="checkshowfront('blur')">
                        <option value="">请选择</option>
                        <option value="1" <if condition="$data.show_front eq 1">selected</if>>是</option>
                        <option value="2" <if condition="$data.show_front eq 2">selected</if>>否</option>
                    </select>
                    <span id="sps16"></span>
                </div>

                <div class="formControls col-xs-9 col-sm-4" style="float: right;">
                    <select id="is_recommend" name="is_recommend" class="input-text" width="10%"
                            onchange="checkisrecommend()">
                        <option value="">请选择</option>
                        <option value="1" <if condition="$data.is_recommend eq 1">selected</if>>是</option>
                        <option value="2" <if condition="$data.is_recommend eq 2">selected</if>>否</option>
                    </select>
                    <span id="sps18"></span>
                </div>
                <label class="form-label col-xs-2 " style="float: right"><span class="c-red">*</span>推荐:</label>
            </div>
        </div>
        <div>
            <div class="row cl col-sm-12">
                <!--<div id="show_background_buy">-->
                <!--<label class="form-label col-xs-2 "><span class="c-red">*</span>后台购买:</label>-->

                <!--<div class="formControls col-xs-9 col-sm-4">-->
                <!--<select id="background_buy" name="background_buy" class="input-text" width="10%"-->
                <!--onchange="checkbackgroundbuy()">-->
                <!--<option value="">请选择</option>-->
                <!--<option value="1">是</option>-->
                <!--<option value="2">否</option>-->
                <!--</select>-->
                <!--<span id="sps17"></span>-->
                <!--</div>-->
                <!--</div>-->
                <label class="form-label col-xs-2 "><span class="c-red">*</span>免运费:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="freight_free" name="freight_free" class="input-text" width="10%"
                            onchange="checkfreightfree()">
                        <option value="">请选择</option>
                        <option value="1" <if condition="$data.freight_free eq 1">selected</if> >是</option>
                        <option value="2" <if condition="$data.freight_free eq 2">selected</if> >否</option>
                    </select>
                    <span id="sps19"></span>
                </div>

                <label class="form-label col-xs-2 ">每吨运费:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <input class="input-text" id="freight_money" name="freight_money" value="<{$data.freight_money}>" onkeyup="checknum(this)">
                    <span id="sps22"></span>
                </div>
            </div>
        </div>
        <!--<div>-->
        <!--<div class="row cl col-sm-12">-->
        <!--<label class="form-label col-xs-2 "><span class="c-red">*</span>优惠活动:</label>-->
        <!--<div class="formControls col-xs-9 col-sm-4">-->
        <!--<select id="preferential_activities" name="preferential_activities" class="input-text" width="10%">-->
        <!--<option value="">请选择</option>-->
        <!--<option value="1">是</option>-->
        <!--<option value="2">否</option>-->
        <!--</select>-->
        <!--</div>-->
        <!--<label class="form-label col-xs-2 "><span class="c-red">*</span>优惠金额:</label>-->
        <!--<div class="formControls col-xs-9 col-sm-4">-->
        <!--<input type="text" class="input-text" id="discount_amount" name="discount_amount" value="" >-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <div>
            <div class="row cl col-sm-12">

                <label class="form-label col-xs-2 "><span class="c-red">*</span>发送短信:</label>

                <div class="formControls col-xs-9 col-sm-4">
                    <select id="send_sms" name="send_sms" class="input-text" width="10%" onchange="checksendsms()">
                        <option value="">请选择</option>
                        <option value="1" <if condition="$data.send_sms eq 1">selected</if>>是</option>
                        <option value="2" <if condition="$data.send_sms eq 2">selected</if>>否</option>
                    </select>
                    <span id="sps20"></span>
                </div>
            </div>

            <div class="row cl col-sm-12" style="height: 31px;">
                <div id="show_remittance_info">
                    <label class="form-label col-xs-2"><span class="c-red">*</span>开户行信息:</label>

                    <div class="formControls col-xs-10 col-sm-10">
                        <select id="remittance_info" name="remittance_info" class="input-text">
                            <option value="">请选择</option>
                        </select>
                        <span id="sps21"></span>

                    </div>
                </div>
            </div>
        </div>
        <div>

        </div>
        <div>
            <div class="row cl col-sm-12">
                <label class="form-label col-xs-2 ">备注:</label>

                <div class="formControls col-xs-9 col-sm-9" style="padding-right: 0;">
                    <textarea class="textarea" cols="" rows="" id="remark" name="remark"><{$data.remark}></textarea>
                </div>
            </div>
        </div>
        <div class="row cl col-sm-12" style="margin-top:10px;">
            <div class="col-xs-8 col-sm-6 col-xs-offset-4 col-sm-offset-6">
                <input type="hidden" id="mall_goods" name="mall_goods" value="3"/>
                <input type="hidden" id="id" name="id" value="<{$data.id}>"/>
                <if condition="$data.is_available eq 1">
                    <input class="btn btn-primary radius" id="add" type="button" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
                </if>
            </div>
        </div>
    </form>
</article>

<script type="text/javascript">
    // @表单验证 <senpai | 2017.3.14>

    //$erpgoods_json = <{$erpgoods_json}>;
    //var storehouse_data = <{$data.storehouse}>;
    var remittance_info = '<{$data.remittance_info}>';
    //console.log(depot_id);
    //console.log(remittance_info);
    //地区查询插件（可复用）
    var selectRegion = $("#region").select2({
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });

    var selectErpGoods = $("#erpgoods").select2({
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });



    var selectUser = $("#user_info").select2({
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });

    var selectCompany = $("#supply_company_id").select2({
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });

    //验证数字（整数）
    function checkinteger(oInput) {
        if ('' != oInput.value.replace(/^[1-9]\d*/, '')) {
            oInput.value = oInput.value.match(/^[1-9]\d*/) == null ? '' : oInput.value.match(/^[1-9]\d*/);
        }
    }

    //验证是否是数字（保留两位小数）
    function checknum(obj){
        obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数
        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value= parseFloat(obj.value);
        }
        if(obj.value.indexOf(".") == 0){
            obj.value = '';
        }
    }

    //验证是否是数字（保留两位小数）
    function checknum4(obj){
        obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{4,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d{4}).*$/,'$1$2.$3');//只能输入两个小数
        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value= parseFloat(obj.value);
        }
        if(obj.value.indexOf(".") == 0){
            obj.value = '';
        }
    }

    //@验证是否是手机号
    function isMobile(phone) {
        var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
        if (reg.test(phone)) {
            return true;
        } else {
            layer.msg('手机号格式不正确', {icon: 2});
            return false;
        }
        ;
    }

    //根据手机号查询公司和交易员
    function changebyuser() {

        //开户行信息清空
        $("#remittance_info").find("option").remove();
        $("#remittance_info").append("<option value=''>" + '请选择' + "</option>");
        $("#sps21").html("");
        $("#sps21").removeClass();

        //验证信息清空
        $("#sps2,#sps3").html("");
        $("#sps2,#sps3").removeClass();

        var user_info = $("#user_info").val();
        var phone = user_info.substr(user_info.indexOf("_") + 1);
        $("#supply_company_id").find("option").remove();
        $("#supply_company_id").append("<option value=''>" + '查询中...' + "</option>");

        var url = '<{:U("User/getInfo")}>';
        var type = 'post';
        var dataType = 'json';
        var data = {phone: phone};
        ajax(url, data, type, dataType, function (_data) {
            if (_data.d_id == _data.s_id) {
                //设置用户信息
                if (_data.u_name != '') {
                    $("#supply_user_id").val(_data.u_id);
                    checktrue('sps1');
                } else {
                    $("#supply_user_id").val('');
                    checkfalse('sps1');
                    submitFalse();
                }

                //设置公司信息
                if (_data['c_name'].length != 0) {
                    $("#supply_company_id").find("option").remove();
                    for (i = 0; i < _data['c_name'].length; i++) {
                        $("#supply_company_id").append("<option value='" + _data['c_name'][i]['id'] + "'>" + _data['c_name'][i]['company_name'] + "</option>");
                    }
                    changeremittance();
                } else {
                    $("#supply_company_id").find("option").remove();
                    if ($.trim(phone).length == 11) {
                        $("#supply_company_id").append("<option value=''>" + '--暂无公司--' + "</option>");
                    } else {
                        $("#supply_company_id").append("<option value=''>" + '查询中...' + "</option>");
                    }
                }
            } else {
                layer.msg("该用户不在你的管理内！", {icon: 2});
                $("#supply_company_id").find("option").remove();
                $("#supply_company_id").append("<option value=''>" + '请选择' + "</option>");
                $("#supply_user_id").val('');
            }
        });
    }

    //根据地区查询
    function changebyregion(region) {
        $region = region || $("#region").val();
        if ($.trim($region) == '') {
            layer.msg("请选择地区！", {icon: 2});
            checkfalse('sps5');
            submitFalse();
            return false;
        }
    }

    //根据公司查询开户行信息
    function changeremittance() {
        checksupplycompanyid();
        var company = $("#supply_company_id").val();
        var url = '<{:U("Clients/getRemittance")}>';
        var type = 'post';
        var dataType = 'json';
        var data = {company: company};
        ajax(url, data, type, dataType, function (_data) {
            //console.log(_data);
            if (_data.length != 0) {
                console.log(_data);
                $("#remittance_info").find("option").remove();

                for (var i = 0; i < _data.length; i++) {
                    $("#remittance_info").append("<option value='" + _data[i].content + "'>" + _data[i].content + "</option>");
                }
                $("#sps21").html("<i class='Hui-iconfont'>&#xe676;</i>");
                $("#sps21").removeClass();
                $("#sps21").addClass("c-green");
            } else {
                $("#remittance_info").find("option").remove();
                $("#remittance_info").append("<option value=''>" + '--暂无信息--' + "</option>");
                $("#sps21").html("<i class='Hui-iconfont'>&#xe706;</i>");
                $("#sps21").removeClass();
                $("#sps21").addClass("c-red");
                submitFalse();
            }
        });
    }

    //商品显示
    function showGoods() {
        $erpgoods = $("#erpgoods").val();
        if ($erpgoods != '') {
            $("#goods_id").val($erpgoods);
            $("#goods_name").html($erpgoods_json[$erpgoods].goods_name);
            $("#source_from").html($erpgoods_json[$erpgoods].source_from);
            $("#grade").html($erpgoods_json[$erpgoods].grade);
            $("#level").html($erpgoods_json[$erpgoods].level);
            checkgoodsid();
        } else {
            $("#goods_id").val('');
            $("#goods_name").html('');
            $("#source_from").html('');
            $("#grade").html('');
            $("#level").html('');
            checkgoodsid();
        }
    }

    //验证信息正确
    function checktrue($place) {
        $('#' + $place).html("<i class='Hui-iconfont'>&#xe676;</i>");
        $('#' + $place).removeClass();
        $('#' + $place).addClass("c-green");
    }

    //验证信息错误
    function checkfalse($place) {
        $('#' + $place).html("<i class='Hui-iconfont'>&#xe706;</i>");
        $('#' + $place).removeClass();
        $('#' + $place).addClass("c-red");
    }

    //验证用户
    function checksupplyuserid() {
        if ($.trim($("#supply_user_id").val()) == '') {
            layer.msg("请输入你名下的用户！", {icon: 2});
            checkfalse('sps1');
            submitFalse();
            return false;
        } else {
            checktrue('sps1');
            return true;
        }
    }

    //验证公司
    function checksupplycompanyid() {
        if ($.trim($("#supply_company_id").val()) == '') {
            layer.msg("请选择公司！", {icon: 2});
            checkfalse('sps2');
            submitFalse();
            return false;
        } else {
            checktrue('sps2');
            return true;
        }
    }

    //验证交易员
    function checkdealername() {
        if ($.trim($("#dealer_name").val()) == '') {
            layer.msg("请确认交易员！", {icon: 2});
            checkfalse('sps3');
            submitFalse();
            return false;
        } else {
            checktrue('sps3');
            return true;
        }
    }

    //验证商品
    function checkgoodsid() {
        //console.log($.trim($("#goods_id").val()) == '');
        if ($.trim($("#goods_id").val()) == '') {
            layer.msg("请选择商品！", {icon: 2});
            checkfalse('sps4');
            submitFalse();
            return false;
        } else {
            checktrue('sps4');
            return true;
        }
    }

    //验证地区
    function checkregion() {
        if ($.trim($("#region").val()) == '') {
            layer.msg("请选择地区！", {icon: 2});
            checkfalse('sps5');
            submitFalse();
            return false;
        } else {
            checktrue('sps5');
            return true;
        }
    }

    //验证油库
    function checkdepotid() {
        console.log($('#depot_id').val());
        if ($.trim($("#depot_id").val()) == '') {
            layer.msg("请选择油库！", {icon: 2});
            checkfalse('sps6');
            submitFalse();
            return false;
        } else {
            checktrue('sps6');
            return true;
        }
    }

    //验证单位价格
    function checkprice() {
        if ($.trim($("#price").val()) == '') {
            layer.msg("请输入单位价格！", {icon: 2});
            checkfalse('sps7');
            submitFalse();
            return false;
        } else {
            checktrue('sps7');
            return true;
        }
    }

    //验证可售数量
    function checksalenum() {
        if ($.trim($("#sale_num").val()) == '') {
            layer.msg("请输入可售数量！", {icon: 2});
            checkfalse('sps8');
            submitFalse();
            return false;
        } else {
            checktrue('sps8');
            return true;
        }
    }

    //验证起售数量
    function checkminsalenum() {
        if ($.trim($("#min_sale_num").val()) == '') {
            layer.msg("请输入起售数量！", {icon: 2});
            checkfalse('sps9');
            submitFalse();
            return false;
        }else if($.trim($("#min_sale_num").val()) <= 0){
            layer.msg("起售数量必须大于0！", {icon: 2});
            checkfalse('sps9');
            submitFalse();
            return false;
        } else if (parseInt($("#min_sale_num").val()) > parseInt($("#sale_num").val())) {
            //console.log($("#min_sale_num").val() > $("#sale_num").val());
            //console.log($("#sale_num").val());
            layer.msg("起售数量不能大于可售数量！", {icon: 2});
            checkfalse('sps9');
            submitFalse();
            return false;
        } else {
            checktrue('sps9');
            return true;
        }
    }

    //验证单笔最大数量
    function checkmaxoncenum() {
        if ($.trim($("#max_once_num").val()) == '') {
            layer.msg("请输入单笔最大数量！", {icon: 2});
            checkfalse('sps10');
            submitFalse();
            return false;
        } else if (parseInt($("#max_once_num").val()) > parseInt($("#sale_num").val())) {
            layer.msg("单笔最大数量不能大于可售数量！", {icon: 2});
            checkfalse('sps10');
            submitFalse();
            return false;
        } else if (parseInt($("#max_once_num").val()) < parseInt($("#min_sale_num").val())) {
            layer.msg("单笔最大数量不能小于起售数量！", {icon: 2});
            checkfalse('sps10');
            submitFalse();
            return false;
        } else {
            checktrue('sps10');
            return true;
        }
    }

    //验证提货方式
    function checkpickupway() {
        if ($.trim($("#pick_up_way").val()) == '') {
            layer.msg("请选择提货方式！", {icon: 2});
            checkfalse('sps11');
            submitFalse();
            return false;
        } else {
            checktrue('sps11');
            return true;
        }
    }

    //验证商品状态
    function checkgoodsstatus() {
        if ($.trim($("#goods_status").val()) == '') {
            layer.msg("请选择商品状态！", {icon: 2});
            checkfalse('sps12');
            submitFalse();
            return false;
        } else {
            checktrue('sps12');
            return true;
        }
    }

    //验证开票类型
    function checkinvoicetype() {
        if ($.trim($("#invoice_type").val()) == '') {
            layer.msg("请选择开票类型！", {icon: 2});
            checkfalse('sps13');
            submitFalse();
            return false;
        } else {
            checktrue('sps13');
            return true;
        }
    }

    //验证是否服务
    function checkisservice() {
        if ($.trim($("#is_service").val()) == '') {
            layer.msg("请选择是否服务！", {icon: 2});
            checkfalse('sps14');
            submitFalse();
            return false;
        } else {
            checktrue('sps14');
            return true;
        }
    }

    //验证是否商城商品
    function checkmallgoods($type) {
        if ($type == 'blur') {
            $("#show_front option[value='2']").prop("selected", false);
            $("#background_buy option[value='1']").prop("selected", false);
            $("#show_front").attr("disabled", false);
            $("#background_buy").attr("disabled", false);
            $("#sps16,#sps17").html("");
            $("#sps16,#sps17").removeClass();
        }
        if ($.trim($("#mall_goods").val()) == '') {
            layer.msg("请选择是否商城商品！", {icon: 2});
            $("#show_background_buy").show();
            $("#show_remittance_info").show();
            checkfalse('sps15');
            submitFalse();
            return false;
        } else if ($.trim($("#mall_goods").val()) == 2) {
            $("#background_buy option[value='1']").prop("selected", true);
            $("#background_buy").attr("disabled", true);
            $("#show_background_buy").hide();
            $("#show_remittance_info").hide();
            checktrue('sps15');
            return true;
        } else {
            $("#show_background_buy").show();
            $("#show_remittance_info").show();
            checktrue('sps15');
            return true;
        }
    }

    //验证是否显示在前台
    function checkshowfront($type) {
        if ($type == 'blur') {
            $("#background_buy option[value='2']").prop("selected", false);
            $("#background_buy").attr("disabled", false);
            $("#sps17").html("");
            $("#sps17").removeClass();
        }
        if ($.trim($("#show_front").val()) == '') {
            layer.msg("请选择是否显示在前台！", {icon: 2});
            checkfalse('sps16');
            submitFalse();
            return false;
        } else if ($.trim($("#show_front").val()) == 1 && $("#mall_goods").val() == 1) {
            $("#background_buy option[value='2']").prop("selected", true);
            $("#background_buy").attr("disabled", true);
            checktrue('sps16');
            checktrue('sps17');
            return true;
        } else {
            checktrue('sps16');
            return true;
        }
    }

    //验证是否后台购买
    function checkbackgroundbuy() {
        if ($.trim($("#background_buy").val()) == '') {
            layer.msg("请选择是否后台购买！", {icon: 2});
            checkfalse('sps17');
            submitFalse();
            return false;
        } else {
            checktrue('sps17');
            return true;
        }
    }

    //验证是否推荐
    function checkisrecommend() {
        if ($.trim($("#is_recommend").val()) == '') {
            layer.msg("请选择是否推荐！", {icon: 2});
            checkfalse('sps18');
            submitFalse();
            return false;
        } else {
            checktrue('sps18');
            return true;
        }
    }

    //验证是否免运费
    function checkfreightfree() {
        if ($.trim($("#freight_free").val()) == '') {
            layer.msg("请选择是否免运费！", {icon: 2});
            checkfalse('sps19');
            $('#freight_money').attr('disabled',true);
            submitFalse();
            return false;
        } else {
            if($.trim($("#freight_free").val()) == 1){
                $('#freight_money').val('');
                $('#freight_money').attr('disabled',true);
            }else{
                $('#freight_money').attr('disabled',false);
            }
            checktrue('sps19');
            return true;
        }
    }

    //验证是否发送短信
    function checksendsms() {
        if ($.trim($("#send_sms").val()) == '') {
            layer.msg("请选择是否发送短信！", {icon: 2});
            checkfalse('sps20');
            submitFalse();
            return false;
        } else {
            checktrue('sps20');
            return true;
        }
    }

    //    //验证开户行信息
    function checkremittanceinfo() {
        if ($.trim($("#remittance_info").val()) == '') {
            layer.msg("请选择开户行信息！", {icon: 2});
            checkfalse('sps21');
            submitFalse();
            return false;
        } else {
            checktrue('sps21');
            return true;
        }
    }

    // @添加
    $(function () {
        changebyregion('<{$data.region}>');
        getRemittance('<{$data.our_company_id}>');

        $('#add').click(function () {

            submitTrue();
//            if ($('#form-member-add').valid() == false) {
//                return false;
//            }
            var da = {
                'id': $("#id").val(),
                'supply_user_id': $("#supply_user_id").val(),
                'supply_company_id': $("#supply_company_id").val(),
                'dealer_id': $("#dealer_id").val(),
                'dealer_name': $("#dealer_name").val(),
                'goods_id': $("#goods_id").val(),
                'goods_status': $("#goods_status").val(),
                'region': $("#region").val(),
                "storehouse_id":$('#storehouse_data').val() ,
                'depot_id': $("#depot_id").val(),
                'price': $("#price").val(),
                'sale_num': $("#sale_num").val(),
                'min_sale_num': $("#min_sale_num").val(),
                'max_once_num': $("#max_once_num").val(),
                'pick_up_way': $("#pick_up_way").val(),
                'invoice_type': $("#invoice_type").val(),
                'is_service': $("#is_service").val(),
                'mall_goods': $("#mall_goods").val(),
                'show_front': $("#show_front").val(),
                'background_buy': 1,
                'is_recommend': $("#is_recommend").val(),
                'freight_free': $("#freight_free").val(),
                'send_sms': $("#send_sms").val(),
                'remittance_info': $("#remittance_info").val(),
                'remark': $("#remark").val(),
                'freight_money': $("#freight_money").val(),
            };
//            if (da.mall_goods == 2) {
//                da.remittance_info = '';
//            }
            //if (checksupplyuserid() && checksupplycompanyid() && checkdealername() && checkgoodsid() && checkregion() && checkdepotid() && checkprice() && checksalenum() && checkminsalenum() && checkmaxoncenum() && checkpickupway() && checkgoodsstatus() && checkinvoicetype() && checkisservice() && checkmallgoods('check') && checkshowfront('check') && checkbackgroundbuy() && checkisrecommend() && checkfreightfree() && checksendsms() && checkremittanceinfo()) {
            if (checksupplyuserid() && checksupplycompanyid() && checkdealername() && checkgoodsid() && checkregion() && checkdepotid() && checkprice() && checksalenum() && checkminsalenum() && checkmaxoncenum() && checkpickupway() && checkgoodsstatus() && checkinvoicetype() && checkisservice() && checkshowfront('check') && checkisrecommend() && checkfreightfree() && checksendsms() && checkremittanceinfo()) {
                layer.load(1, {shade: 0.3});
                var url = '<{:U("ErpSupplyMall/actUpdateSupply")}>';
                var type = 'post';
                var dataType = 'json';
                var data = da;
                ajax(url, data, type, dataType, function (_data) {
                    if (_data.status == 1) {
                        layer.closeAll();
                        layer.msg(_data.message, {icon: 1});
                        parent.searchSupplyMallList();
                        setTimeout(function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                            submitFalse();
                        }, 500);
                    } else {
                        layer.closeAll();
                        layer.msg(_data.message, {icon: 2});
                        submitFalse();
                    }
                });
            } else {
                //layer.closeAll();
            }
        });
    });

    // @添加下单按钮禁用属性
    function submitTrue() {
        $('#add').attr("disabled", true).val('处理中...').addClass('disabled');
    }

    // @移除下单按钮禁用属性
    function submitFalse() {
        $('#add').attr("disabled", false).val('提交').removeClass('disabled');
    }
    /**
     * 获取银行账号信息
     * @param company_id
     */
    function getRemittance(company_id) {
        //查询该公司所有的银行帐号信息，包含clients表和clientsinfo表
        //var company_id = company_id;
        var url = '<{:U("Clients/getRemittance")}>';
        var type = 'post';
        var dataType = 'json';
        var data = {company: company_id, all: 1};
        $('#remittance_info').html('');
        ajax(url, data, type, dataType, function (_data) {

            if (!$.isEmptyObject(_data)) {
                var options = '<option value="">请选择</option>';
                var selected = '';
                for (var i in _data) {
                    selected = remittance_info == $.trim(_data[i].content) ? 'selected' : '';
                    options += '<option value="' + _data[i].content + '"'+selected+'>' + _data[i].content + '</option>';

                }
            } else {
                var options = '<option value="">-暂无银行帐号-</option>';
            }
            $('#remittance_info').html(options);
        })
    }
    function checkstorehouse (){
        var url = '<{:U("ErpStorehouseDepot/getStorehouseDepot")}>';
            var type = 'post';
            var dataType = 'json';
            var storehouse_id = $('#storehouse_data').val();

            var data = {storehouseId: storehouse_id};
            ajax(url, data, type, dataType, function (_data) {
                if(_data.status != 0){
                    $("#depot_id").find("option").remove();
                    $("#depot_id").append("<option value=''>请选择</option>");
                    $("#depot_id").append("<option value='99999'>不限油库</option>");
                }else{
                   $("#depot_id").find("option").remove();
                    $("#depot_id").append("<option value=''>请选择</option>");
                    $("#depot_id").append("<option value='99999' >不限油库</option>");
                    var depotList = _data.list ;
                    for (i = 0; i < depotList.length; i++) {
                        if (depotList[i].depot_name.substr(-2, 2) == '油库') {
                            $("#depot_id").append("<option value='" + depotList.id + "' >" + depotList[i].depot_name + "</option>");
                        } else {
                            $("#depot_id").append("<option value='" + depotList[i].id + "' >" + depotList[i].depot_name + "油库</option>");
                        }
                    }   
                }
                
            });
            checktrue('sps5');
            return true;
    }
</script>
