<include file="./Application/Home/View/headers.html"/>
<style>
    .disabled {
        cursor: no-drop;
        background-color: #9D9D9D;
    }

    .input-text {
        width: 78%
    }
</style>
<div class="page-container">
    <form class="form form-horizontal" id="form-article-add">
        <div id="tab-system" class="HuiTab">
            <div class="tabBar clearfix">
                <span>基本信息</span>
                <span>联系人</span>
                <span>银行账号</span>
            </div>
            <div id="information" class="tabCon">
                <form action="" method="post" class="form form-horizontal" id="form-order-add">
                    <div style="overflow: hidden">
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>供应商名称：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="supplier_name" name="supplier_name" value="<{$data.data.supplier_name}>" disabled/>
                                </div>
                            </div>

                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red"></span>简称：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " id="supplier_short_name" name="supplier_short_name" value="<{$data.data.supplier_short_name}>" />
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>企业税号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.tax_number}>" id="tax_number" name="tax_number" maxlength="20" />
                                </div>
                            </div>

                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>注册银行名称：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.registered_bank}>" id="registered_bank" name="registered_bank" maxlength="50" />
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>注册银行账号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.registered_bank_number}>" id="registered_bank_number" name="registered_bank_number" maxlength="50" />

                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red"></span>注册电话：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.registered_tel}>" placeholder="" id="registered_tel" name="registered_tel" />
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>注册地址：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " placeholder="" id="registered_address" name="registered_address" value="<{$data.data.registered_address}>"/>
                                </div>
                            </div>

                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red"></span>公司电话：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.company_tel}>" placeholder="" id="company_tel" name="company_tel" />
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red"></span>邮编：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text " value="<{$data.data.post_code}>" placeholder="" id="post_code" name="post_code" maxlength="10"/>

                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>是否团内：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <select id="is_inner" name="is_inner" class="input-text " style="width:100%;" >
                                        <option value="0">请选择</option>
                                        <volist name="data.isInner" id="vo" key="k">
                                            <option value="<{$key}>" <if condition="$data['data']['is_inner'] eq $key">selected</if> >
                                                <{$vo}>
                                            </option>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-8">
                                <label class="form-label col-xs-3 col-sm-3"><span class="c-red">*</span>公司地址：</label>
                                <div class="formControls col-xs-8 col-sm-8">
                                    <select name="address_province" class="input-text" style="width:35%" id="address_province" onchange="change_shipping_city(this.value)">
                                        <optgroup label="省份列表">
                                            <option value="0">省份</option>
                                            <volist name="data.province_list" id="vo" key="k">
                                                <option value="<{$key}>" <if condition="$data['data']['address_province'] eq $key">selected</if> >
                                                    <{$vo}>
                                                </option>
                                            </volist>
                                        </optgroup>
                                    </select>

                                    <select name="address_city" class="input-text" style="width:29%" id="address_city" onchange="change_shipping_county(this.value)">
                                        <optgroup label="城市列表">
                                            <option value="0">城市</option>
                                        </optgroup>
                                    </select>

                                    <select name="address_zone" class="input-text" style="width:31%" id="address_zone" >
                                        <optgroup label="地区列表">
                                            <option value="0">地区</option>
                                        </optgroup>
                                    </select>
                                    <span id="sps23"></span>

                                    <!--<input type="text" class="input-text" value="" placeholder="" id="company_address" name="company_address" />-->
                                </div>
                            </div>
                            <div class="row cl col-sm-4">
                                <input type="text" class="input-text" id="company_address" name="company_address" value="<{$data.data.company_address}>" />
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">公司级别：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <select id="company_level" name="company_level" class="input-text " style="width:100%;" >
                                        <option value="0">请选择</option>
                                        <volist name="data.level" id="vo" key="k">
                                            <option value="<{$key}>" <if condition="$data['data']['company_level'] eq $key">selected</if> >

                                                <{$vo}>
                                            </option>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>业务属性：</label>

                                <div class="formControls col-xs-7 col-sm-7">
                                    <select id="business_attributes" name="business_attributes" class="input-text " style="width:100%;" >
                                        <option value="0">请选择</option>
                                        <volist name="data.businessAttributes" id="vo" key="k">
                                            <option value="<{$key}>" <if condition="$data['data']['business_attributes'] eq $key">selected</if> >
                                                <{$vo}>
                                            </option>
                                        </volist>
                                    </select>
                                </div>
                                <span></span>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>状态：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="radio" name="status" value="1" <if condition="$data['data']['status'] eq 1">checked</if>> 有效

                                    <input type="radio" name="status" value="2" <if condition="$data['data']['status'] eq 2">checked</if> > 无效
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <!--<label class="form-label col-xs-4 col-sm-4">特需采购：</label>-->

                                <!--<div class="formControls col-xs-8 col-sm-8 skin-minimal">-->
                                <!--<div class="check-box">-->
                                <!--<input type="checkbox" value="1" id="is_special" name="is_special" class=""-->
                                <!--<{$data['order']['is_special'] == 1 ? 'checked' : ''}> disabled>-->
                                <!--<label for="is_special">&nbsp;</label>-->
                                <!--</div>-->
                                <!--</div>-->
                            </div>
                        </div>

                        <div class="row cl">
                            <label class="form-label col-xs-2 col-sm-2">备注：</label>

                            <div class="formControls col-xs-10 col-sm-10" style="padding-left: 10px">
                                <textarea id="company_remark" name="company_remark" style="height:100px;width:96%;" class="input-text " maxlength="255" ><{$data.data.company_remark}></textarea>
                            </div>
                        </div>

                    </div>
                    <div class="row cl" style="margin-top:20px;">
                        <div class="col-xs-8 col-sm-6 col-xs-offset-6 col-sm-offset-5">
                   

                        </div>
                    </div>
                </form>
            </div>
            <div class="tabCon">
                <form action="" method="post" class="form form-horizontal" id="form-invoice-add" style="display: none;">
                    <div style="overflow: hidden" id="userList">
                        <div class="row cl user_info">
                            <div class="row cl col-sm-5">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>联系人：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text"  name="user_name" id="user_name" value="" maxlength="8"/>
                                    <span id="sps1"></span>
                                </div>
                            </div>

                            <div class="row cl col-sm-7">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>联系电话：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text"  name="user_phone" id="user_phone" value="" maxlength="11" style="width:180px;"/>
                                    <input type="hidden" class="input-text"  name="user_id" id="user_id" value="" maxlength="11" style="width:180px;"/>
                                    <span id="sps2"></span>
                                    <!--<span><a href="javascript:;" onclick="addUserInfo(this);" class="btn btn-primary radius check_access" value="ErpGoods-showAddErpGoods"><i class="Hui-iconfont"></i>+</a>&nbsp;</span>&lt;!&ndash;&#xe600;&ndash;&gt;-->
                                    <!--<span><a href="javascript:;" onclick="delUserInfo(this);" class="btn btn-primary radius check_access delUser" value="ErpGoods-showAddErpGoods"><i class="Hui-iconfont"></i>-</a>&nbsp;</span>&lt;!&ndash;&#xe600;&ndash;&gt;-->
                                </div>
                            </div>
                        </div>

                        <div class="row cl" style="margin-top:20px;">
                            <div class="col-xs-8 col-sm-6 col-xs-offset-6 col-sm-offset-5">
                                <input type="hidden" id="id" name="id" value="<{$data.id}>">
                                <!--<input type="hidden" id="purchase_id" name="purchase_id"-->
                                <!--value="<{$data['order']['id']}>">-->
                                <!--<input type="hidden" id="purchase_order_number" name="purchase_order_number"-->
                                <!--value="<{$data['order']['order_number']}>">-->
                                <input class="btn btn-primary radius" id="DealerSaveBtn" type="button" value="提交">&nbsp;&nbsp;&nbsp;

                                <input class="btn btn-primary radius" id="cancelUser" type="button" value="取消">
                                <!--<input class="btn btn-primary radius" id="goback" type="button" value="返回">-->
                            </div>
                        </div>
                    </div>
                </form>
                <div>
                    <br/>

                    <!--<p>联系人列表</p>-->
                    <!--<hr/>-->
                    <div class="row cl" style="margin-top:20px;">
                    <div style="margin-left: 15px;">
                    <form class="Huiform" method="post" action="<{:U('Galaxy/uploadZip')}>" target="_self" id="form1" enctype ="multipart/form-data">
                  <!--   <input class="btn btn-primary radius" id="add_new_user" type="button" onclick="erpgoods_add('新增')" value="新增">
                    <input class="btn btn-primary radius" id="update_user" type="button" onclick="erpgoods_update('编辑')" value="编辑"> -->
                    </form>
                    </div>
                    </div>
                    <div class="row cl">
                    <table class="table table-border table-bordered table-hover table-bg table-sort" id="dataTable">
                    <thead>
                    <tr class="text-c">
                    <th>
                    <input type="checkbox" name="" value="">
                    </th>
                    <th>ID</th>
                    <th>联系人</th>
                    <th>联系人电话</th>
                    <th>创建人</th>
                    <th>创建时间</th>
                    <th>更新人</th>
                    <th>更新时间</th>

                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                    <tfoot>

                    </tfoot>
                    </table>
                    </div>
                </div>
            </div>
             <div class = "tabCon">
               
                <div>
                    <br/>
                    <div class="row cl">
                        <table class="table table-border table-bordered table-hover table-bg table-sort-back" id="dataBackTable">
                            <thead>
                            <tr class="text-c">

                                <th>选择</th>
                                <th>创建人</th>
                                <th>更新人</th>
                                <th>银行名称</th>
                                <th>银行账号</th>
                                <th>创建时间</th>
                                <th>更新时间</th>

                            </tr>
                            </thead>
                            <tbody>

                            </tbody>
                            <tfoot>

                            </tfoot>
                        </table>
                    </div>
                </div>
        </div>
        <div class="row cl">
            <div class="col-xs-8 col-sm-8 col-xs-offset-4 col-sm-offset-2">
                <!--<button onClick="article_save_submit();" class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存</button>-->
                <!--<button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>-->
            </div>
        </div>
    </form>
</div>

<link rel="stylesheet" href="__TPL__lib/select2/css/select2.min.css"/>
<script type="text/javascript" src="__TPL__lib/select2/js/select2.min.js"></script>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
    //查看详情
    var is_view = '<{$Think.get.view}>' ? 1 : 0;
    console.log(is_view);
    if(is_view == 1){
        $("input:button").hide();
    }
    //已审核不允许编辑
    var audit_status = '<{$data.data.audit_status}>';

    if(audit_status == 1){
        //$("#addSupplierBtn").hide();
        $('form').find('input,textarea,select').attr('disabled', true).addClass('disabled');
        // $("#addSupplierBtn,#registered_bank_number, #registered_bank, #address_province, #address_city, #address_zone, #company_address").attr('disabled', false).removeClass('disabled');
        $("#goNext").hide();
    }
    $(function () {
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });
        $.Huitab("#tab-system .tabBar span", "#tab-system .tabCon", "current", "click", "0");
        //$('input,select,textarea', $('#information')).attr('disabled', true);

    });
    hiddenFirstDel();
    function hiddenFirstDel() {
        $('.delUser').eq(0).hide();
    }
    function addUserInfo(obj) {
        var user_obj = $(obj).parents('.user_info');
        user_obj.find('.delUser').show();
        var user_tpl = user_obj.clone();
        //console.log(user_tpl);
        user_obj.after(user_tpl);
        hiddenFirstDel();
    }
    function delUserInfo(obj) {
        $(obj).parents('.user_info').remove();
    }
    var da ={};
    da.supplier_id = $('#id').val();
        var table = $('.table-sort').dataTable({
            "paging": true,
            "serverSide": true,
            "iDisplayLength": 10,
            "displayStart": 0,
            ajax: {
                //url: "<{:U('Galaxy/orderList')}>",
                url: "<{:U('ErpSupplier/getSupplierUserList')}>",
                type: 'post',
                data: da
            },
            "aaSorting": [[2, "desc"]],//默认第几个排序
            "bStateSave": false, //状态保存
            "aoColumnDefs": [
                //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
                //{"orderable":false,"aTargets":[0,1]}// 制定列不参与排序
            ],
            columnDefs: [{
                orderable: false,
                className: 'select-checkbox',
                targets: 0
            }],
            select: {
                style: 'os',
                selector: 'td:first-child'
            },
            "deferRender": true, //延迟渲染
            "searching": false,
            "bPaginate": true,
            "bLengthChange": true,
            "columns": [
                {
                    "sClass": "text-c",
                    "data": null,
                    "render": function (data, type, full, meta) {
                        return '<input name="check_box_list" type="checkbox"  class="checkchild"  value="' + data.id + '" />';
                    }
                },
                {"data": "id"},
                {"data": "user_name"},
                {"data": "user_phone"},
                {"data": "creater"},
                {"data": "create_time"},
                {"data": "updater"},
                {"data": "update_time"}

            ],
        });

    searchSupplierUser = function(){
        var id = $("#id").val();
        table.api().ajax.url("<{:U('ErpSupplier/getSupplierUserList')}>") +'/id/'+id;
        table.api().ajax.reload(null,false);
    }

    $("#goNext").click(function () {
        $.Huitab("#tab-system .tabBar span", "#tab-system .tabCon", "current", "click", "1");
    })


    $("#goback").click(function () {
        $.Huitab("#tab-system .tabBar span", "#tab-system .tabCon", "current", "click", "0");
    })

    $('#cancelUser').click(function () {
        resetUserForm()
        userFormHide();
    })
    function userFormShow() {
        $('#form-invoice-add').show(100);
    }
    function resetUserForm() {
        $('input[name="user_name"]').val('');
        $('input[name="user_phone"]').val('');
        $('input[name="user_id"]').val('');
    }
    function userFormHide() {
        $('#form-invoice-add').hide(100);
    }


     var selectProvince = $("#address_province").select2({
        placeholder: '请选择省份',
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });
    var selectRegion = $("#address_city").select2({
        placeholder: '请选择城市',
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });
    var selectCounty = $("#address_zone").select2({
        placeholder: '请选择地区',
        //allowClear: true
    }).on('select2-open', function () {
        $(this).data('select2').results.addClass('overflow-hidden').perfectScrollbar();
    });
    var city    = <{$data.city}>;
    var county  = <{$data.county}>;

    change_shipping_city('<{$data.data.address_province}>');

    change_shipping_county('<{$data.data.address_city}>');
    // 二级联动提油城市
    function change_shipping_city(id) {
        var citylist = city[id];
        var city_id = '<{$data.data.address_city}>';
        if(id <= 0) return false;
        var options = '<option value=0>请选择</option>';
        var selected = '';
        $.each(citylist, function (i, item) {
            if ( city_id == item.id) {
                selected = 'selected="selected"';
            } else {
                selected = '';
            }
            options += '<option value="' + item.id + '" ' + selected + '>' + item.area_name + '</option>';
        });
        $('#address_city').html(options);
    }
    // 三级联动提油地区
    function change_shipping_county(id) {
        var citylist = county[id];
        var zone_id = '<{$data.data.address_zone}>';
        if(id <= 0) return false;
        var options = '<option value=0>请选择</option>';
        var selected = '';
        $.each(citylist, function (i, item) {
            if (zone_id == item.id) {
                selected = 'selected="selected"';
            } else {
                selected = '';
            }
            options += '<option value="' + item.id + '" ' + selected + '>' + item.area_name + '</option>';
        });
        $('#address_zone').html(options);
    }

   

   //银行账号
     var table = $('.table-sort-back').dataTable({
        "paging": true,
        "serverSide": true,
        "iDisplayLength": 10,
        "displayStart": 0,
        ajax: {
            url: "<{:U('ErpSupplier/getSupplierBackList')}>",
            type: 'post',
            data: da
        },
        "aaSorting": [[2, "desc"]],//默认第几个排序
        "bStateSave": false, //状态保存
        "aoColumnDefs": [
        ],
        columnDefs: [{
            orderable: false,
            className: 'select-checkbox',
            targets: 0
        }],
        select: {
            style: 'os',
            selector: 'td:first-child'
        },
        "deferRender": true, //延迟渲染
        "searching": false,
        "bPaginate": true,
        "bLengthChange": true,
        "columns": [
            {
                "sClass": "text-c",
                "data": null,
                "render": function (data, type, full, meta) {
                    return '<input name="check_box_list" type="checkbox"  class="checkBack"  value="' + data.id + '" />';
                }
            },
            {"data": "creater"},
            {"data": "updater"},
            {"data":"ext_info_content"},
            {"data":"ext_info_content_two"},
            {"data": "create_time"},
            {"data": "update_time"}

        ],
    });

   
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>