<include file="./Application/Home/View/headers.html"/>
<style>
    .disabled {
        cursor: no-drop;
        background-color: #9D9D9D;
    }
</style>
<article class="page-container">
    <form action="" method="post" class="form form-horizontal" id="form-member-add" autocomplete="off">

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>姓名：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="<{$data.dealer_name}>" placeholder="姓名" id="dealer_name"
                       name="dealer_name" onblur="getUserName();">
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>用户名：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="<{$data.dealer_username}>" placeholder=""
                       id="dealer_username" name="dealer_username">
            </div>
        </div>
        <!--<input type="hidden" class="input-text" value="<{$data.dealer_username}>" placeholder="" id="dealer_username" name="dealer_username">-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>密码：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="password" class="input-text" value="<{$data.dealer_pwd}>" placeholder="" id="dealer_pwd"
                       name="dealer_pwd">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">手机：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="<{$data.dealer_phone}>" placeholder="" id="dealer_phone"
                       name="dealer_phone">
            </div>
        </div>
        <!--<div class="row cl">-->
        <!--<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>性别：</label>-->
        <!--<div class="formControls col-xs-8 col-sm-9 skin-minimal">-->
        <!--<div class="radio-box">-->
        <!--<input name="sex" type="radio" id="sex-1" value="男" <if condition="$data.sex eq '男'">checked</if> >-->
        <!--<label for="sex-1">男</label>-->
        <!--</div>-->
        <!--<div class="radio-box">-->
        <!--<input type="radio" id="sex-2" name="sex" value="女" <if condition="$data.sex eq '女'">checked</if> >-->
        <!--<label for="sex-2">女</label>-->
        <!--</div>-->

        <!--</div>-->
        <!--</div>-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>邮箱：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" placeholder="@" name="dealer_email" id="dealer_email"
                       value="<{$data.dealer_email}>">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">QQ：</label>

            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" placeholder="联系QQ" name="qq" id="qq" value="<{$data.qq}>">
            </div>
        </div>
        <!--<div class="row cl">-->
        <!--<label class="form-label col-xs-4 col-sm-3">附件：</label>-->
        <!--<div class="formControls col-xs-8 col-sm-9"> <span class="btn-upload form-group">-->
        <!--<input class="input-text upload-url" type="text" name="uploadfile" id="uploadfile" readonly nullmsg="请添加附件！" style="width:200px">-->
        <!--<a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>-->
        <!--<input type="file" multiple name="file-2" class="input-file">-->
        <!--</span> </div>-->
        <!--</div>-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属分公司：</label>

            <div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select class="select" size="1" name="corporation_id" id="corporation_id">
                    <option value="">请选择分公司</option>
                    <volist name="data.DealerCompany.company" id="vo">
                        <option value="<{$vo.id}>"
                        <if condition="$data['corporation_id'] eq $vo['id']">selected="selected"</if>
                        ><{$vo.name}></option>
                    </volist>
                </select>
				</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所属部门：</label>

            <div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select class="select" size="1" name="department_id" id="department_id">
                    <option value="">请选择部门</option>
                    <volist name="data.DealerCompany.department" id="vo">
                        <option value="<{$vo.id}>"
                        <if condition="$data['department_id'] eq $vo['id']">selected="selected"</if>
                        ><{$vo.name}></option>
                    </volist>
                </select>
				</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>所在城市：</label>

            <div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select class="select" size="1" name="region" id="region">
                    <option value="">请选择城市</option>
                    <volist name="data.regionData" id="vo">
                        <option value="<{$key}>"
                        <if condition="$data['region'] eq $key">selected="selected"</if>
                        ><{$vo}></option>
                    </volist>
                </select>
				</span>
            </div>
        </div>
        <!--<div class="row cl">-->
        <!--<label class="form-label col-xs-4 col-sm-3">备注：</label>-->
        <!--<div class="formControls col-xs-8 col-sm-9">-->
        <!--<textarea name="beizhu" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" onKeyUp="textarealength(this,100)"></textarea>-->
        <!--<p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>-->
        <!--</div>-->
        <!--</div>-->
        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input type="hidden" id="id" value="<{$data.id}>" name="id">
                <input class="btn btn-primary radius" id="DealerSaveBtn" type="button"
                       value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</article>

<include file="./Application/Home/View/footers.html"/>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
    if ($('#id').val()) {
        $('#dealer_name').attr('disabled', true);
        $('#dealer_username').attr('disabled', true);
    }
    $(function () {
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });
        $('#DealerSaveBtn').click(function () {
            if ($('#form-member-add').valid() == false) {
                return false;
            }
            var url = '<{:U("Api/Dealer/addDealer")}>';
            if ($('#id').val()) {
                url = '<{:U("Api/Dealer/editDealer")}>';
            }

            var type = 'post';
            var dataType = 'json';
            var data = $('form').serializeArray();
            var dealer_phone = $.trim($('#dealer_phone').val());
            if (dealer_phone != '' && !isMobile(dealer_phone)) {
                layer.msg('手机号格式不正确', {icon: 2});
                return false;
            }
            submitTrue();
            ajax(url, data, type, dataType, function (_data) {
                //console.log(_data);
                if (_data.status == 1) {
                    layer.msg(_data.msg, {icon: 1});
                    top.searthes();
                    setTimeout(function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    }, 1000);
                } else {
                    submitFalse();
                    layer.msg(_data.msg, {icon: 2});
                    return false;
                }
            });
        });
        $("#form-member-add").validate({
            rules: {
                dealer_name: {
                    required: true,
                    minlength: 2,
                    maxlength: 16
                },
//			dealer_username:{
//				required:true,
//				minlength:2,
//				maxlength:16
//			},
                dealer_pwd: {
                    required: true,
                    minlength: 2,
                    maxlength: 16
                },
//			dealer_phone:{
//				required:true,
//				//isMobile:true,
//			},
                dealer_email: {
                    required: true,
                    email: true,
                },
//			qq:{
//				required:true,
//				minlength:2,
//				maxlength:16
//			},
                corporation_id: {
                    required: true,
                },
                department_id: {
                    required: true,
                },

                region: {
                    required: true,
                },
            },
            onkeyup: false,
            focusCleanup: true,
            success: "valid",
            submitHandler: function (form) {
                //$(form).ajaxSubmit();

            }
        });

    });
    function getUserName() {

        var url = '<{:U("Api/Dealer/ajaxGetDealerUserName")}>';

        var type = 'post';
        var dataType = 'json';
        var dealer_name = $.trim($('#dealer_name').val());
        var data = {'dealer_name': dealer_name};
        submitTrue();
        ajax(url, data, type, dataType, function (_data) {
            if (_data.status == 1) {
                submitFalse();
                $('#dealer_username').val(_data.dealer_username);
                //layer.msg(_data.msg, {icon: 1});
            } else {
                layer.msg(_data.msg, {icon: 2});
                return false;
            }

        });
    }
    // @添加下单按钮禁用属性
    function submitTrue() {
        $('#DealerSaveBtn').attr("disabled", true).val('处理中').addClass('disabled');
    }

    // @移除下单按钮禁用属性
    function submitFalse() {
        $('#DealerSaveBtn').attr("disabled", false).val('提交').removeClass('disabled');
    }
    function isMobile(phone) {
        var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
        if (reg.test(phone)) {
            return true;
        } else {
            return false;
        }
        ;
    }
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>