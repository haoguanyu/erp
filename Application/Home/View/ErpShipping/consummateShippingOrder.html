<include file="./Application/Home/View/headers.html"/>
<style>
    .disabled {
        cursor: no-drop;
        background-color: #9D9D9D;
    }

    .input-text {
        width: 78%
    }
</style>
<div class="page-container">
    <form class="form form-horizontal" id="form-article-add">
        <div id="tab-system" class="HuiTab">
            <div class="tabBar clearfix">
                <span>基本信息</span>
                <span>配送信息</span>
            </div>
            <div id="information" class="tabCon">
                <form action="" method="post" class="form form-horizontal">
                    <div style="overflow: hidden">
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">需求单号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="source_number" name="source_number" value="<{$data.order.source_number}>" disabled/>
                                </div>
                            </div>

                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">业务单号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="source_order_number" name="source_order_number" value="<{$data.order.source_order_number}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">来源单据类型：</label>
                                <div class="formControls col-xs-8 col-sm-8">
                                    <select id="source_type" name="source_type" class="input-text disabled" style="width:78%;">
                                        <option value="0">请选择</option>
                                        <volist name="data.source_type" id="vo" key="k">
                                            <option value="<{$key}>"
                                            <if condition="$data['order']['source_type'] eq $key">selected</if>
                                            >
                                            <{$vo}>
                                            </option>
                                        </volist>
                                    </select>
                                </div>
                            </div>

                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">公司名称：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="company_name" name="company_name" value="<{$data.order.company_name}>" disabled/>
                                    <input type="hidden" class="input-text disabled" id="company_id" name="company_id" value="<{$data.order.company_id}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">客户：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="user_name" name="user_name" value="<{$data.order.user_name}>" disabled/>
                                    <input type="hidden" class="input-text disabled" id="user_id" name="user_id" value="<{$data.order.user_id}>" disabled/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">客户联系方式：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="user_phone" name="user_phone" value="<{$data.order.user_phone}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">商品代码：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="goods_code" name="goods_code" value="<{$data['order']['goods_code']}>" disabled>
                                    <input type="hidden" class="input-text disabled" id="goods_id" name="goods_id" value="<{$data['order']['goods_id']}>" disabled>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">商品名称：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="goods_name" name="goods_name" value="<{$data['order']['goods_name']}>" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">商品来源：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="goods_from" name="goods_from" value="<{$data['order']['source_from']}>" disabled>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">商品标号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="goods_grade" name="goods_grade" value="<{$data['order']['grade']}>" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">商品级别：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="goods_level" name="goods_level" value="<{$data['order']['level']}>" disabled>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">配送数量：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text disabled" id="shipping_num" name="shipping_num" value="<{$data.order.shipping_num}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">城市：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <select id="region" name="region" class="input-text disabled" style="width:78%;">
                                        <option value="0">请选择</option>
                                        <volist name="region.region_list" id="vo" key="k">
                                            <option value="<{$key}>"
                                            <if condition="$data['order']['region'] eq $key">selected</if>
                                            >
                                            <{$vo}>
                                            </option>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="tabCon">
                <form action="" method="post" class="form form-horizontal">
                    <div style="overflow: hidden">
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">需求送达日期：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text Wdate disabled" value="<{$data.order.business_shipping_time}>" id="business_shipping_time" name="business_shipping_time" maxlength="20" onfocus="WdatePicker({lang:'zh-cn',dateFmt: 'yyyy-MM-dd'})" disabled/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>铅封号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="seal_number" name="seal_number" onblur="checksealnumber()" value="<{$data.order.seal_number}>"/>
                                    <span id="sps1"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">提油地址：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="shipping_address" name="shipping_address" value="<{$data.order.shipping_address}>" disabled/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">送油地址：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="receiving_address" name="receiving_address" value="<{$data.order.receiving_address}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">承运方：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="shipper" name="shipper" value="<{$data.order.shipper}>" disabled/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">车牌号：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="car_number" name="car_number" value="<{$data.order.car_number}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">司机姓名：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="driver_name" name="driver_name" value="<{$data.order.driver_name}>" disabled/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">司机联系方式：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="driver_phone" name="driver_phone" value="<{$data.order.driver_phone}>" disabled/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>油库确认出库时间：</label>
                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text Wdate" value="" id="depot_out_time" name="depot_out_time" maxlength="20" onfocus="WdatePicker({lang:'zh-cn',dateFmt: 'yyyy-MM-dd HH:mm:ss'})" onchange="checkdepotOutTime()"/>
                                    <span id="sps4"></span>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>实际送达时间：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text Wdate" value="" id="actual_in_time" name="actual_in_time" maxlength="20" onfocus="WdatePicker({lang:'zh-cn',dateFmt: 'yyyy-MM-dd HH:mm:ss'})" onchange="checkactualInTime()"/>
                                    <span id="sps5"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>卸货量：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="unloading_num" name="unloading_num" value="<{$data.order.unloading_num}>" onkeyup="checknum4(this)" onblur="checkunloadingnum()"/>
                                    <span id="sps2"></span>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4"><span class="c-red">*</span>装载量：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="loading_num" name="loading_num" value="<{$data.order.loading_num}>" onkeyup="checknum4(this)" onblur="checkloadingnum()"/>
                                    <span id="sps3"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">运费：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="freight" name="freight" value="<{$data.order.freight}>" onkeyup="checknum4(this)"/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">杂费：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="incidental" name="incidental" value="<{$data.order.incidental}>" onkeyup="checknum4(this)"/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">视温：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="temperature" name="temperature" value="<{$data.order.temperature}>" onkeyup="checknumnegative1(this)"/>
                                </div>
                            </div>
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">视密：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="density" name="density" value="<{$data.order.density}>" onkeyup="checknum4(this)"/>
                                </div>
                            </div>
                        </div>
                        <div class="row cl">
                            <div class="row cl col-sm-6">
                                <label class="form-label col-xs-4 col-sm-4">损耗：</label>

                                <div class="formControls col-xs-8 col-sm-8">
                                    <input type="text" class="input-text" id="loss_num" name="loss_num" value="<{$data.order.loss_num}>" onkeyup="checknum4(this)"/>
                                </div>
                            </div>
                            <div class="row cl col-sm-12">
                                <label class="form-label col-xs-2 col-sm-2">备注：</label>

                                <div class="formControls col-xs-10 col-sm-10" style="padding-left: 10px">
                                    <textarea id="remark" name="remark" style="height:100px;width:96%;" class="input-text" maxlength="255"><{$data['order']['remark']}></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row cl" style="margin-top:20px;">
            <div class="col-xs-8 col-sm-6 col-xs-offset-6 col-sm-offset-6">
                <input type="hidden" id="id" value="<{$data.order.id}>">
                <input class="btn btn-primary radius" id="DealerSaveBtn" type="button" value="提交">
            </div>
        </div>
    </form>
</div>

<link rel="stylesheet" href="__TPL__lib/select2/css/select2.min.css"/>
<script type="text/javascript" src="__TPL__lib/select2/js/select2.min.js"></script>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
    $(function () {
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });
        $.Huitab("#tab-system .tabBar span", "#tab-system .tabCon", "current", "click", "1");
        $('input,select,textarea', $('#information')).attr('disabled', true);
    });

    /* 基本信息 */
    $('#DealerSaveBtn').click(function () {
        layer.confirm('完善物流信息后将无法再修改信息,请确认', {
            btn: ['确定', '取消']
        }, function () {
            submitTrue();
            var da = {
                'id': $("#id").val(),
                'unloading_num': $("#unloading_num").val(),
                'loading_num': $("#loading_num").val(),
                'temperature': $("#temperature").val(),
                'density': $("#density").val(),
                'freight': $("#freight").val(),
                'incidental': $("#incidental").val(),
                'loss_num': $("#loss_num").val(),
                'seal_number': $("#seal_number").val(),
                'depot_out_time': $("#depot_out_time").val(),
                'actual_in_time': $("#actual_in_time").val(),
                'remark': $("#remark").val(),
            };
            if (checksealnumber() && checkunloadingnum() && checkloadingnum()) {
                layer.load(1, {shade: 0.3});
                var url = '<{:U("ErpShipping/consummateShippingOrder")}>';
                var type = 'post';
                var dataType = 'json';
                var data = da;

                ajax(url, data, type, dataType, function (_data) {
                    if (_data.status == 1) {
                        layer.closeAll();
                        layer.msg(_data.message, {icon: 1});
                        parent.searchShippingOrderList();
                        setTimeout(function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                            submitFalse();
                        }, 500);
                    } else {
                        layer.closeAll();
                        layer.msg(_data.message, {icon: 2});
                        submitFalse();
                        return false;
                    }
                });
            }
        });
    });

    //验证铅封号
    function checksealnumber(){
        if ($.trim($("#seal_number").val()) == 0) {
            layer.msg("请填写铅封号！", {icon: 2});
            checkfalse('sps1');
            submitFalse();
            return false;
        } else {
            checktrue('sps1');
            return true;
        }
    }

    //验证卸货量
    function checkunloadingnum(){
        if ($.trim($("#unloading_num").val()) == 0) {
            layer.msg("请填写卸货量！", {icon: 2});
            checkfalse('sps2');
            submitFalse();
            return false;
        } else {
            checktrue('sps2');
            return true;
        }
    }

    //验证装载量
    function checkloadingnum(){
        if ($.trim($("#loading_num").val()) == 0) {
            layer.msg("请填写装载量！", {icon: 2});
            checkfalse('sps3');
            submitFalse();
            return false;
        } else {
            checktrue('sps3');
            return true;
        }
    }

    //油库确认出库时间
    function checkdepotOutTime() {
        if ($.trim($("#depot_out_time").val()) == 0) {
            layer.msg("请选择油库确认出库时间！", {icon: 2});
            checkfalse('sps4');
            submitFalse();
            return false;
        }else{
            checktrue('sps4');
            return true;
        }
    }

    //实际送达时间
    function checkactualInTime(){
        if ($.trim($("#actual_in_time").val()) == 0) {
            layer.msg("请选择实际送达时间！", {icon: 2});
            checkfalse('sps5');
            submitFalse();
            return false;
        }  else if($.trim($("#actual_in_time").val()) < $.trim($("#depot_out_time").val())){
            layer.msg("实际送达时间必须大于油库出库时间！", {icon: 2});
            checkfalse('sps5');
            submitFalse();
            return false;
        }else {
            checktrue('sps5');
            return true;
        }
    }
    //验证是否是数字（保留两位小数）
    function checknum(obj){
        obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数
        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value= parseFloat(obj.value);
        }
        if(obj.value.indexOf(".") == 0){
            obj.value = '';
        }
    }

    //验证是否是数字（保留4位小数）
    function checknum4(obj){
        obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{4,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d{4}).*$/,'$1$2.$3');//只能输入两个小数
        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            obj.value= parseFloat(obj.value);
        }
        if(obj.value.indexOf(".") == 0){
            obj.value = '';
        }
    }

    //验证是否是数字（保留一位小数可以为负数）
    function checknumnegative1(obj){
        obj.value = obj.value.replace(/[^\-\d.]/g,"");  //清除“数字”和“.”以外的字符
        obj.value = obj.value.replace(/\.{1,}/g,"."); //只保留第一个. 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d).*$/,'$1$2.$3');//只能输入两个小数
        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            if(!isNaN(obj.value)){
                obj.value= parseFloat(obj.value);
            }
        }
        if(obj.value.indexOf(".") == 0){
            obj.value = '';
        }
        var regex = new RegExp("-","g");
        var result = obj.value.match(regex);
        result = result ? result : [];
        if(obj.value.indexOf("-") > 0 || result.length > 1){
            obj.value = '';
        }
    }

    //    //验证是否是数字（保留两位小数可以为负数）
    //    function checknum(obj){
    //        obj.value = obj.value.replace(/[^\-\d.]/g,"");  //清除“数字”和“.”以外的字符
    //        obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的
    //        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
    //        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数
    //        if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
    //            if(!isNaN(obj.value)){
    //                obj.value= parseFloat(obj.value);
    //            }
    //        }
    //        if(obj.value.indexOf(".") == 0){
    //            obj.value = '';
    //        }
    //        var regex = new RegExp("-","g");
    //        var result = obj.value.match(regex);
    //        result = result ? result : [];
    //        if(obj.value.indexOf("-") > 0 || result.length > 1){
    //            obj.value = '';
    //        }
    //    }

    // @添加下单按钮禁用属性
    function submitTrue() {
        $('#DealerSaveBtn').attr("disabled", true).addClass('disabled').val('处理中');
    }

    // @移除下单按钮禁用属性
    function submitFalse() {
        $('#DealerSaveBtn').attr("disabled", false).removeClass('disabled').val('提交');
    }

    $('.table-sort tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
        }
    });

    $('#dataTable tbody').on('click', 'tr', function () {

        var index = $(this).index();
        if ($('#dataTable tbody tr').eq(index).find('.checkchild').prop('checked') == false) {
            $('#dataTable tbody tr').eq(index).find('.checkchild').prop('checked', true);
        } else {
            $('#dataTable tbody tr').eq(index).find('.checkchild').prop('checked', false);
        }
        $('#dataTable tbody tr').eq(index).siblings().find('.checkchild').prop('checked', false);

    });

    //验证信息正确
    function checktrue($place) {
        $('#' + $place).html("<i class='Hui-iconfont'>&#xe676;</i>");
        $('#' + $place).removeClass();
        $('#' + $place).addClass("c-green");
    }

    //验证信息错误
    function checkfalse($place) {
        $('#' + $place).html("<i class='Hui-iconfont'>&#xe706;</i>");
        $('#' + $place).removeClass();
        $('#' + $place).addClass("c-red");
    }
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>